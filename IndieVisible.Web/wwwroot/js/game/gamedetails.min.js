var CONTENTACTIONS=function(){"use strict";function f(){e();o();s()}function e(){n.container=".content";n.btnShare=".btn-share";n.sharePopup=".share-popup";n.btnInteractionComment=".btn-interaction-comment";n.commentBox=".interaction-commentbox";n.commentTextArea=".commenttextarea"}function o(){t.container=$(n.container)}function s(){h();c();l();a();v()}function h(){t.container.on("click",".btn-interaction-like",function(){var n=$(this),t=n.closest(".box-content").find(".like-count"),i=n.data("id");n.hasClass("like-liked")?w(i).done(function(i){b(i,t,n)}):y(i).done(function(i){p(i,t,n)})})}function c(){$(".content").on("click",n.btnInteractionComment,function(){var t=$(this),i=t.closest(".box-content").find(".box-commentsection"),r=t.closest(".box-content").find(n.commentBox),u=t.closest(".box-content").find(n.commentTextArea);i.is(":visible")?(i.addClass("d-none"),r.addClass("d-none")):(i.removeClass("d-none"),r.removeClass("d-none"),u.val("").focus())})}function l(){$(".content").on("keyup","textarea.commentbox",function(n){var f=$(this);if((n.keyCode===10||n.keyCode===13)&&n.ctrlKey){var t=f.closest(".interaction-commentbox").find(".commenttextarea"),o=t.data("url"),s=f.closest(".box-content").find(".comment-count"),h=t.data("usercontentid"),e=t.val().replace(/\n/g,"<br>\n"),c=t.data("usercontenttype");e.length>0&&i(o,h,e,c).done(function(n){r(n,s,t)})}u(this)})}function a(){$(".content").on("click",".btn-interaction-comment-send",function(){var u=$(this),n=u.closest(".interaction-commentbox").find(".commenttextarea"),f=n.data("url"),e=n.closest(".box-content"),o=e.find(".comment-count"),s=n.data("usercontentid"),t=n.val().replace(/\n/g,"<br>\n"),h=n.data("usercontenttype");t.length>0&&i(f,s,t,h).done(function(t){r(t,o,n)})})}function v(){t.container.on("click",n.btnShare,function(t){var u;t.preventDefault();$(n.sharePopup).fadeOut();var i=$(this).prop("href"),f=$(this).data("title"),r=$(this).data("provider");return i=encodeURI(i),r==="facebook"?FB.ui({method:"share",href:i},function(){}):r==="reddit"?(i="https://www.reddit.com/submit?title="+f+"&url="+i,window.open(i)):r==="twitter"?(u=$(this).data("text"),i="https://www.twitter.com/intent/tweet?text="+u+" "+i,window.open(i)):console.log(r),!1})}function y(n){return $.post("/content/like",{targetId:n})}function p(n,t,i){n.success===!0&&($(t).text(n.value),i.addClass("text-blue"),i.addClass("like-liked"))}function w(n){return $.post("/content/unlike",{targetId:n})}function b(n,t,i){n.success===!0&&($(t).text(n.value),i.removeClass("text-blue"),i.removeClass("like-liked"))}function i(n,t,i,r){return(n===null||n===undefined||n.length===0)&&(n="/content/comment"),$.post(n,{UserContentId:t,Text:i,UserContentType:r})}function r(n,t,i){var u,f,r,e,o;n.success===!0&&(u=i.closest(".interaction-commentbox"),f=i.val().replace(/\n/g,"<br>\n"),i.val(""),$(t).text(n.value),CONTENTACTIONS.AutosizeTextArea(i[0]),r=$(".box-comment-template").first().clone(),e=u.find("img").attr("src"),r.find("img").attr("src",e),r.find(".comment-authorname").text(u.data("fullname")),r.find(".comment-content").html(f),o=i.closest(".box-comments").find(".box-commentsection"),o.append(r.removeClass("d-none")))}function u(n){setTimeout(function(){n.style.cssText="height:auto;";n.style.cssText="height:"+(n.scrollHeight+2)+"px"},0)}var n={},t={};return{Init:f,AutosizeTextArea:u}}();$(function(){CONTENTACTIONS.Init()});var FEEDTYPE={HOME:1,USER:2,GAME:3,ARTICLES:4},ACTIVITYFEED=function(){"use strict";function e(u,f,e){r=f;i=e;n.divActivityFeed=u;t.btnMorePosts="#btnMorePosts";t.btnDeletePost=".btnDeletePost";n.btnInteractionShare=".btn-interaction-share";n.sharePopup=".share-popup";o()}function o(){s();h()}function s(){$("body").on("click",t.btnMorePosts,function(){var n=$(this);u=n.data("oldestid");f=n.data("oldestdate");n.html(MAINMODULE.Default.SpinnerBtn);ACTIVITYFEED.Methods.LoadActivityFeed(!1)})}function h(){$("body").on("click",t.btnDeletePost,function(n){n.preventDefault();var t=$(this),i=t.data("id"),r=t.data("confirmationmessage"),u=t.data("confirmationtitle"),f=t.data("confirmationbuttontext"),e=t.data("cancelbuttontext");return ALERTSYSTEM.ShowConfirmMessage(u,r,f,e,function(){$.ajax({url:"/content/"+i,type:"DELETE"}).done(function(n){if(n.success){var i=t.closest(".box-content");i.remove();n.message&&ALERTSYSTEM.ShowSuccessMessage(n.message)}else ALERTSYSTEM.ShowWarningMessage(n.message)})}),!1})}function c(e,o){e!==!1&&n.divActivityFeed.append(MAINMODULE.Default.Spinner);var s="/content/feed?load=1";i&&r===FEEDTYPE.USER&&(s+="&userId="+i);i&&r===FEEDTYPE.GAME&&(s+="&gameId="+i);r===FEEDTYPE.ARTICLES&&(s+="&articlesOnly=True");u&&(s+="&oldestId="+u);f&&(s+="&oldestDate="+f);$.get(s,function(i){f!==undefined&&u!==undefined?(n.divActivityFeed.find(".spinner").remove(),$(t.btnMorePosts).parent().remove(),n.divActivityFeed.append(i)):n.divActivityFeed.html(i);l();a();o&&o()})}function l(){$(n.btnInteractionShare).each(function(t,i){var r=$(i),u=r.data();if(u.target){$(r).off("click");$(r).on("click",function(){var t=$(u.target),i=r.position();t.css("top",i.top-80);t.on("mouseleave",function(){setTimeout(function(){t.is(":visible")&&t.fadeOut()},500)});$(n.sharePopup).fadeOut();t.is(":visible")?t.fadeOut():t.fadeIn()})}})}function a(){if(typeof Embedo=="function"){var n=new Embedo({youtube:!0,facebook:{appId:$('meta[property="fb:app_id"]').attr("content"),version:"v3.2",width:"100%"}}),t=$("oembed");t.each(function(t,i){var r=$(i).closest(".videoWrapper"),u,f;r.hasClass("loaded")||($(i).find("embed").hide(),u=r.width(),f=u*9/16,n.load(i,i.innerHTML,{width:u,height:f,centerize:!0,strict:!1}).done(function(){r.addClass("loaded")}))})}}var n={},t={},r,i,u,f;return{Init:e,Methods:{LoadActivityFeed:c},Events:{}}}(),GAMEDETAILS=function(){"use strict";function t(){i();r();ACTIVITYFEED.Init(n.divActivityFeed,FEEDTYPE.GAME,n.Id.val());ACTIVITYFEED.Methods.LoadActivityFeed();o()}function i(){n.tabActivity=$("#tabactivity");n.divActivityFeed=$("#tabactivity #divActivityFeed");n.Id=$("#Id")}function r(){u();f();e()}function u(){$(".content").on("click","#btn-game-like",function(){var n=$(this),t=n.closest(".game-page").find(".like-count"),i=n.data("id");n.hasClass("like-liked")?c(i).done(function(i){l(i,t,n)}):s(i).done(function(i){h(i,t,n)})})}function f(){$(".content").on("click","#btn-game-follow",function(){var n=$(this),t=n.closest(".game-page").find(".follow-count"),i=n.data("id");n.hasClass("follow-following")?y(i).done(function(i){p(i,t,n)}):a(i).done(function(i){v(i,t,n)})})}function e(){$(".content").on("click","#btn-game-share",function(n){n.preventDefault();var t=$(this).prop("href");FB.ui({method:"share",href:t},function(){})})}function o(){$("[data-toggle='popover']").each(function(n,t){var i=$(t).data(),r,u;i.target&&(r=i.target,u=$(r).html(),i.content=u,i.html=!0);$(t).popover(i)})}function s(n){return $.post("/game/like",{likedId:n})}function h(n,t,i){n.success===!0?($(t).text(n.value),i.addClass("bg-red"),i.addClass("like-liked")):ALERTSYSTEM.ShowWarningMessage(n.message)}function c(n){return $.post("/game/unlike",{likedId:n})}function l(n,t,i){n.success===!0?($(t).text(n.value),i.removeClass("bg-red"),i.removeClass("like-liked")):ALERTSYSTEM.ShowWarningMessage(n.message)}function a(n){return $.post("/game/follow",{gameId:n})}function v(n,t,i){n.success===!0?($(t).text(n.value),i.addClass("bg-blue"),i.addClass("follow-following")):ALERTSYSTEM.ShowWarningMessage(n.message)}function y(n){return $.post("/game/unfollow",{gameId:n})}function p(n,t,i){n.success===!0?($(t).text(n.value),i.removeClass("bg-blue"),i.removeClass("follow-following")):ALERTSYSTEM.ShowWarningMessage(n.message)}var n={};return{Init:t}}();$(function(){GAMEDETAILS.Init()});