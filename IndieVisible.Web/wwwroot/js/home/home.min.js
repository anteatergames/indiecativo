var CONTENTACTIONS=function(){"use strict";function e(){o();s();h()}function o(){n.container=".content";n.btnShare=".btn-share";n.sharePopup=".share-popup";n.btnInteractionComment=".btn-interaction-comment";n.commentBox=".interaction-commentbox";n.commentTextArea=".commenttextarea";n.btnInteractionShare=".btn-interaction-share";n.sharePopup=".share-popup"}function s(){t.container=$(n.container)}function h(){c();l();a();v();y();i()}function c(){t.container.on("click",".btn-interaction-like",function(){var n=$(this),t=n.closest(".box-content").find(".like-count"),i=n.data("id");n.hasClass("like-liked")?b(i).done(function(i){k(i,t,n)}):p(i).done(function(i){w(i,t,n)})})}function l(){$(".content").on("click",n.btnInteractionComment,function(){var t=$(this),i=t.closest(".box-content").find(".box-commentsection"),r=t.closest(".box-content").find(n.commentBox),u=t.closest(".box-content").find(n.commentTextArea);i.is(":visible")?(i.addClass("d-none"),r.addClass("d-none")):(i.removeClass("d-none"),r.removeClass("d-none"),u.val("").focus())})}function a(){$(".content").on("keyup","textarea.commentbox",function(n){var i=$(this);if((n.keyCode===10||n.keyCode===13)&&n.ctrlKey){var t=i.closest(".interaction-commentbox").find(".commenttextarea"),o=t.data("url"),s=i.closest(".box-content").find(".comment-count"),h=t.data("usercontentid"),e=t.val().replace(/\n/g,"<br>\n"),c=t.data("usercontenttype");e.length>0&&r(o,h,e,c).done(function(n){u(n,s,t)})}f(this)})}function v(){$(".content").on("click",".btn-interaction-comment-send",function(){var i=$(this),n=i.closest(".interaction-commentbox").find(".commenttextarea"),f=n.data("url"),e=n.closest(".box-content"),o=e.find(".comment-count"),s=n.data("usercontentid"),t=n.val().replace(/\n/g,"<br>\n"),h=n.data("usercontenttype");t.length>0&&r(f,s,t,h).done(function(t){u(t,o,n)})})}function y(){t.container.on("click",n.btnShare,function(t){var u;t.preventDefault();$(n.sharePopup).fadeOut();var i=$(this).prop("href"),f=$(this).data("title"),r=$(this).data("provider");return i=encodeURI(i),r==="facebook"?FB.ui({method:"share",href:i},function(){}):r==="reddit"?(i="https://www.reddit.com/submit?title="+f+"&url="+i,window.open(i)):r==="twitter"?(u=$(this).data("text"),i="https://www.twitter.com/intent/tweet?text="+u+" "+i,window.open(i)):console.log(r),!1})}function i(){$(n.btnInteractionShare).each(function(t,i){var r=$(i),u=r.data();if(u.target){$(r).off("click");$(r).on("click",function(){console.log("clickshare");var t=$(u.target),i=r.position();t.css("top",i.top-80);t.on("mouseleave",function(){setTimeout(function(){t.is(":visible")&&t.fadeOut()},500)});$(n.sharePopup).fadeOut();t.is(":visible")?t.fadeOut():t.fadeIn()})}})}function p(n){return $.post("/content/like",{targetId:n})}function w(n,t,i){n.success===!0&&($(t).text(n.value),i.addClass("text-blue"),i.addClass("like-liked"))}function b(n){return $.post("/content/unlike",{targetId:n})}function k(n,t,i){n.success===!0&&($(t).text(n.value),i.removeClass("text-blue"),i.removeClass("like-liked"))}function r(n,t,i,r){return(n===null||n===undefined||n.length===0)&&(n="/content/comment"),$.post(n,{UserContentId:t,Text:i,UserContentType:r})}function u(n,t,i){var u,f,r,e,o;n.success===!0&&(u=i.closest(".interaction-commentbox"),f=i.val().replace(/\n/g,"<br>\n"),i.val(""),$(t).text(n.value),CONTENTACTIONS.AutosizeTextArea(i[0]),r=$(".box-comment-template").first().clone(),e=u.find("img").attr("src"),r.find("img").attr("src",e),r.find(".comment-authorname").text(u.data("fullname")),r.find(".comment-content").html(f),o=i.closest(".box-comments").find(".box-commentsection"),o.append(r.removeClass("d-none")))}function f(n){setTimeout(function(){n.style.cssText="height:auto;";n.style.cssText="height:"+(n.scrollHeight+2)+"px"},0)}var n={},t={};return{Init:e,AutosizeTextArea:f,BindShareContent:i}}(),POLLS,embedo;$(function(){CONTENTACTIONS.Init()});POLLS=function(){"use strict";function t(){i();r()}function i(){n.divPostPoll=$("div#divPostPoll");n.options=$("input.polloptioninput")}function r(){u();f();e()}function u(){$(".content").on("click","#btnAddOption",function(){var u=n.divPostPoll.children(".polloption:first"),t=u.clone(),i=t.children(".polloptioninput"),r;i.val("");r=t.find(".btn-option-remove");$(r).removeClass("invisible");t.insertBefore("#btnAddOption");t.addClass("polloptionextra");i.focus();POLLS.Events.PostAddOption()})}function f(){$(".content").on("click",".btn-option-remove",function(){var n=$(this).closest(".polloption");n.remove();POLLS.Events.PostAddOption()})}function e(){$(".content").on("click","ul.poll.canvote li input.poll-option",function(){var n=$(this);s(n.val()).done(function(t){h(t,n)})})}function o(){n.options.val("");$(".polloptionextra").remove()}function s(n){return $.post("/interact/poll/vote",{pollOptionId:n}).done(function(n){n.success&&MAINMODULE.Common.HandlePointsEarned(n)})}function h(n,t){var u,e,i;if(n.success===!0){var r=t.closest("ul.poll"),s=r.closest(".poll-wrapper"),h=s.find(".poll-vote-count"),c=r.children("li");for($(c).each(function(){var n=$(this);n.removeClass("voted").addClass("notvoted");var t=n.children("span.perc-back"),i=n.children("span.perc-number"),r=n.find("input");t.css("width","0");i.text("0.00%");r.prop("checked",!1)}),u=$(t).parent("li"),u.removeClass("notvoted").addClass("voted"),e=u.find("input"),e.prop("checked",!0),i=0;i<n.value.optionResults.length;i++){var f=n.value.optionResults[i],l=r.find(`input[value="${f.optionId}"]`),o=l.parent("li"),a=o.children("span.perc-back"),v=o.children("span.perc-number");a.css("width",f.percentage+"%");v.text(f.percentage+"%")}h.text(n.value.totalVotes)}}var n={};return{Init:t,Methods:{ClearOptions:o},Events:{PostAddOption:function(){}}}}();$(function(){POLLS.Init()});var FEEDTYPE={HOME:1,USER:2,GAME:3,ARTICLES:4},ACTIVITYFEED=function(){"use strict";function e(u,f,e){r=f;i=e;n.divActivityFeed=u;t.btnMorePosts="#btnMorePosts";t.btnDeletePost=".btnDeletePost";n.btnInteractionShare=".btn-interaction-share";n.sharePopup=".share-popup";o()}function o(){s();h()}function s(){$("body").on("click",t.btnMorePosts,function(){var n=$(this);u=n.data("oldestid");f=n.data("oldestdate");n.html(MAINMODULE.Default.SpinnerBtn);ACTIVITYFEED.Methods.LoadActivityFeed(!1)})}function h(){$("body").on("click",t.btnDeletePost,function(n){n.preventDefault();var t=$(this),i=t.data("id"),r=t.data("confirmationmessage"),u=t.data("confirmationtitle"),f=t.data("confirmationbuttontext"),e=t.data("cancelbuttontext");return ALERTSYSTEM.ShowConfirmMessage(u,r,f,e,function(){$.ajax({url:"/content/"+i,type:"DELETE"}).done(function(n){if(n.success){var i=t.closest(".box-content");i.remove();n.message&&ALERTSYSTEM.ShowSuccessMessage(n.message)}else ALERTSYSTEM.ShowWarningMessage(n.message)})}),!1})}function c(e,o){e!==!1&&n.divActivityFeed.append(MAINMODULE.Default.Spinner);var s="/content/feed?load=1";i&&r===FEEDTYPE.USER&&(s+="&userId="+i);i&&r===FEEDTYPE.GAME&&(s+="&gameId="+i);r===FEEDTYPE.ARTICLES&&(s+="&articlesOnly=True");u&&(s+="&oldestId="+u);f&&(s+="&oldestDate="+f);$.get(s,function(i){f!==undefined&&u!==undefined?(n.divActivityFeed.find(".spinner").remove(),$(t.btnMorePosts).parent().remove(),n.divActivityFeed.append(i)):n.divActivityFeed.html(i);CONTENTACTIONS.BindShareContent();l();o&&o()})}function l(){if(typeof Embedo=="function"){var n=new Embedo({youtube:!0,facebook:{appId:$('meta[property="fb:app_id"]').attr("content"),version:"v3.2",width:"100%"}}),t=$("oembed");t.each(function(t,i){var r=$(i).closest(".videoWrapper"),u,f;r.hasClass("loaded")||($(i).find("embed").hide(),u=r.width(),f=u*9/16,n.load(i,i.innerHTML,{width:u,height:f,centerize:!0,strict:!1}).done(function(){r.addClass("loaded")}))})}}var n={},t={},r,i,u,f;return{Init:e,Methods:{LoadActivityFeed:c},Events:{}}}(),HOMEPAGE=function(){"use strict";function b(){k();d();et();ot();e=Math.ceil(n.txtPostContent.height());POLLS.Events.PostAddOption=i;ACTIVITYFEED.Init(n.divActivityFeed,FEEDTYPE.HOME);ACTIVITYFEED.Methods.LoadActivityFeed();ht()}function k(){n.divCounters=$("#divCounters");n.divLatestGames=$("#divLatestGames");n.divActivityFeed=$("#divActivityFeed");n.divPostImages=$("div#divPostImages");n.divPostPoll=$("div#divPostPoll");n.txtPostContent=$("#txtPostContent");n.commentBox=$(".commentmodal");n.commentModal=$(".commentmodal .modal");n.postImages=$("#txtPostImages");n.commentModalBody=undefined}function d(){rt();nt();tt();g();it();ut()}function g(){$(".content").on("keydown","textarea.postbox",function(n){var i=$(this),t;(n.keyCode===10||n.keyCode===13)&&n.ctrlKey&&(t=i.val(),t.length>0);st(this)})}function nt(){$(".content").on("click",".posttextarea",function(){r===!1&&(o(),n.commentModalBody=$(".commentmodal .modal .modal-body"));$(this).focus();i();n.commentModal.animate({scrollTop:0},"fast")})}function tt(){Dropzone.autoDiscover=!1;$(".content").on("click","#btnPostAddImage",function(){if(r===!1&&o(),u)s(),t&&(t.destroy(),t=null);else{if(u=!0,!t){c();t.on("addedfile",function(){i()})}n.divPostImages.show()}i()})}function it(){$(".content").on("click","#btnPostAddPoll",function(){r===!1&&o();f?(a(),POLLS.Methods.ClearOptions()):ft();i()})}function rt(){$(".content").on("click","#btnSendSimpleContent",function(){var s=$(this),i=s.closest(".simplecontentpostarea").find(".posttextarea"),r=i.val().replace(/\n/g,"<br>\n"),e,o,u;if(r.length===0)return ALERTSYSTEM.ShowWarningMessage("You must type a text to post!"),!1;var h=n.commentBox.find("#postlanguage"),l=h.val(),a=document.getElementsByClassName("polloptioninput"),f=$(a).map(function(){var n=$(this).next().children(),t=n.data("image");return this.value?{text:this.value,image:t}:null}).get();if(t&&t.getQueuedFiles().length!==0){t.processQueue();u=!1;t.on("success",function(t){var i=JSON.parse(t.xhr.response);i.uploaded?(u=!0,n.postImages.val(n.postImages.val()+"|"+i.url)):i.error&&ALERTSYSTEM.ShowWarningMessage(i.error)});t.on("queuecomplete",function(){if(u===!0){var e=n.postImages.val(),o={text:r,images:e,pollOptions:f};v(o).done(function(n){y(n,i);t&&(t.destroy(),t=null);c()})}})}else e=n.postImages.val(),o={text:r,images:e,pollOptions:f,language:l},v(o).done(function(n){n.success&&y(n,i)})})}function ut(){$("#modalPost").on("hidden.bs.modal",function(){s();a();r===!0?(n.txtPostContent.val(""),l()):i();POLLS.Methods.ClearOptions()})}function c(){t=new Dropzone("div#divPostImages",{url:"/storage/uploadcontentimage",paramName:"upload",addRemoveLinks:!0,autoProcessQueue:!1,maxFiles:1})}function o(){r=!0;$("#modalPost").addClass("modal");$("#modalPost").modal("show");n.commentBox.css("min-height",h+"px");n.commentModal.css("padding-right","");$(".commentmodal .modal-header").removeClass("d-none");$(".commentmodal .modal-footer").removeClass("d-none");$(".commentmodal .modal-header .close").show();$(".modal-backdrop").css("height",window.innerHeight+"px");$(".modal-backdrop").css("top",window.pageYOffset+"px")}function i(){var o=n.divPostImages.outerHeight(),s=n.divPostPoll.outerHeight(),r=Math.floor(n.txtPostContent.height()),h=r===e?0:r-e,t=w+h,i=0;u&&(t+=o,i+=10);f&&(t+=s,i+=10);t+=i;n.commentModalBody.height(n.txtPostContent.height());n.commentModal.height(t);n.commentBox.height(t)}function l(){r=!1;$(".commentmodal .modal").css("padding-right","");$("#modalPost").modal("hide");$("#modalPost").css("display","");$("#modalPost").removeClass("modal");$(".commentmodal .modal-header .close").hide();$(".commentmodal .modal-header").addClass("d-none");$(".commentmodal .modal-footer").addClass("d-none");$(".commentmodal").css("height","");$(".commentmodal").css("min-height","");n.commentModalBody.height("38px");p(n.txtPostContent[0])}function s(){u=!1;n.divPostImages.hide()}function a(){f=!1;n.divPostPoll.hide()}function ft(){f=!0;n.divPostPoll.show()}function v(n){return $.post("/content/post",n).done(function(n){n.success||ALERTSYSTEM.ShowWarningMessage(n.message)})}function y(i,r){l();s();t&&t.removeAllFiles();i.success===!0&&(r.val(""),CONTENTACTIONS.AutosizeTextArea(r[0]),ACTIVITYFEED.Methods.LoadActivityFeed(),t&&t.disable(),n.postImages.val(""),MAINMODULE.Common.HandlePointsEarned(i))}function et(){n.divCounters.html(MAINMODULE.Default.Spinner);$.get("/home/counters",function(t){n.divCounters.html(t)})}function ot(){n.divLatestGames.html(MAINMODULE.Default.Spinner);$.get("/game/latest",function(t){n.divLatestGames.html(t)})}function st(n){setTimeout(function(){p(n);i()},0)}function p(n){n.style.cssText="height:auto;";n.style.cssText="height:"+(n.scrollHeight+2)+"px"}function ht(){var n=window.matchMedia("screen and (min-width: 992px)").matches,t=window.matchMedia("screen and (min-width: 1200px)").matches;n&&MAINMODULE.Layout.SetStickyElement("#infobox");t&&MAINMODULE.Layout.SetStickyElement("#divCounters")}var r=!1,u=!1,f=!1,t=null,h=147,w=h,e=0,n={};return{Init:b}}();$(function(){HOMEPAGE.Init()});typeof Embedo=="function"&&(embedo=new Embedo({youtube:!0,facebook:{appId:$('meta[property="fb:app_id"]').attr("content"),version:"v3.2",width:"100%"}}));Dropzone.autoDiscover=!1;