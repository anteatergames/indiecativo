var TRANSLATION=function(){"use strict";function d(){n.controlsidebar=".control-sidebar";n.canInteract="#caninteract";n.urls="#urls";n.container="#featurecontainer";n.containerDetails="#containerdetails";n.containerList="#containerlist";n.list="#divList";n.divListItem=".feature-item";n.myProjects="#divMyProjects";n.btnNew="#btn-new";n.form="#frmTranslationSave";n.btnSave="#btnSaveTranslation";n.btnEdit=".btnEditTranslationProject";n.btnDelete=".btnDeleteTranslationProject";n.divTerms="#divTerms";n.template=".translation-term.template";n.btnAddTerm="#btn-translation-term-add";n.btnDeleteTerm=".btn-term-delete";n.ddlLanguage="#Language";n.btnFilter=".btn-filter";n.entry=".translation-entry";n.entryInput=":input.entry-input";n.entryActions=".translation-entry-actions";n.entrySave=n.entryActions+" .entry-save";n.entryCancel=n.entryActions+" .entry-cancel";n.entryAuthors=".entry-authors";n.entryAuthorTemplate=".entry-author.template";n.entryAuthorButton=".entry-author-btn";n.divUploadTerms="div#divUploadTerms";n.btnUploadTerms="#btnUploadTerms";n.btnSaveTerms="#btnSaveTerms";n.ddlColumn=".ddlcolumn";n.id="#Id";n.termItem=".translation-term";n.changedCounter="#changedtranslationscounter";n.btnSaveTranslationChanges="#btnSaveTranslationChanges";n.divNoItems="#divNoItems";n.termCounter="#termCounter"}function g(){t.controlsidebar=$(n.controlsidebar);t.container=$(n.container);t.urls=$(n.urls);t.containerDetails=$(n.containerDetails)}function nt(){t.containerDetails=$(n.containerDetails);t.containerList=$(n.containerList);t.list=$(n.list);t.myProjects=$(n.myProjects)}function tt(){t.ddlLanguage=$(n.ddlLanguage);t.entryAuthors=$(n.entryAuthors);t.changedCounter=$(n.changedCounter)}function it(){t.form=$(n.form);t.divUploadTerms=$(n.divUploadTerms);t.divTerms=$(n.divTerms);t.btnUploadTerms=$(n.btnUploadTerms);t.id=$(n.id);t.termCounter=$(n.termCounter)}function o(){it();dt();gt();pt();wt();MAINMODULE.Common.BindPopOvers();vi();y();wi()}function rt(){tt();ot();pi();s(t.ddlLanguage)}function ut(){if(d(),g(),ft(),u=t.container.find(n.canInteract).val(),a=window.location.href.indexOf("add")>-1,f=window.location.href.indexOf("translate")>-1,e=window.location.href.indexOf("edit")>-1,l=!a&&!f&&!e,l){nt();var i=t.urls.data("urlList"),r=t.urls.data("urlMine");ni(!1,i);ti(!1,r)}else f?rt():e&&o()}function ft(){et();yt()}function et(){t.container.on("click",n.btnNew,function(){var n=$(this).data("url");u&&ii(n)})}function ot(){bt();kt();ht();st();ct();vt();at();lt();CONTENTACTIONS.BindShareContent();MAINMODULE.Common.BindPopOvers()}function st(){t.containerDetails.on("change",n.ddlLanguage,function(){var i=$(this);t.containerDetails.find(n.entryInput).val("");$(n.entryInput).data("originalval","");b();s(i)})}function ht(){t.containerDetails.on("click",n.btnFilter,function(){var r=$(this),i=r.data("filter");i!=="Untranslated"&&s(t.ddlLanguage);var u=t.containerDetails.find(n.entryInput),f=i==="All"||i==="Translated",e=i==="All"||i==="Untranslated";u.each(function(t,i){var r=$(i),u=r.data("translated");u&&f||!u&&e?r.closest(n.entry).show():r.closest(n.entry).hide()})})}function ct(){t.containerDetails.on("click",n.entrySave,function(){var o=$(this),i=o.closest(n.entry).find(n.entryInput),u=i.data("termid"),s=t.urls.data("urlEntrySave"),f=t.ddlLanguage.val(),e;f&&i.val().length>0&&(e={termId:u,language:f,value:i.val()},$.post(s,e).done(function(n){n.success===!0?(si(n.value.termId,n.value.userId),p(n.value),w(),k(r,u),n.message&&ALERTSYSTEM.Toastr.ShowWarning(n.message)):ALERTSYSTEM.ShowWarningMessage("An error occurred! Check the console!")}))})}function lt(){t.containerDetails.on("click",n.btnSaveTranslationChanges,function(){var s=t.urls.data("urlEntriesSave"),f=t.ddlLanguage.val(),u,i,e,o;if(f){for(u=[],i=0;i<r.length;i++)e=$(n.entryInput+"[data-termid="+r[i]+"]"),o={termId:r[i],value:e.val()},u.push(o);$.post(s,{language:f,entries:u}).done(function(t){var i,u;if(t.success===!0){for(i=0;i<r.length;i++)u=$(n.entryInput+"[data-termid="+r[i]+"]"),u.data("changed",!1),u.data("originalval",u.val());r=[];b();t.message&&ALERTSYSTEM.Toastr.ShowWarning(t.message)}else ALERTSYSTEM.ShowWarningMessage("An error occurred! Check the console!")})}})}function at(){t.containerDetails.on("blur",n.entryInput,function(){var n=$(this),u=t.ddlLanguage.val(),f=n.data("originalval"),i=n.data("termid"),e=n.val(),o=f!==e;u&&(o?n.data("changed")!==!0&&(r.push(i),n.data("changed",!0),yi()):n.data("changed")===!0&&(k(r,i),n.data("changed",!1),w()))})}function vt(){t.containerDetails.on("click",n.entryAuthorButton,function(){var t=$(this),i=t.closest(n.entry).find(n.entryInput),r=t.data("value");i.val(r)})}function yt(){t.containerDetails.on("click",n.btnSave,function(n){var i,f,r,e;return n.preventDefault(),i=$(this),MAINMODULE.Common.RemoveErrorFromButton(i),MAINMODULE.Common.DisableButton(i),f=t.form.valid(),f&&u?(r=!0,e=t.form.find(":input[data-val-required]"),e.each(function(){r===!0&&$(this).val().length===0&&(r=!1)}),r?ci(i):(MAINMODULE.Common.EnableButton(i),ALERTSYSTEM.ShowWarningMessage("All terms must have key and value!"))):MAINMODULE.Common.SetButtonWithError(i),!1})}function pt(){t.containerDetails.on("click",n.btnUploadTerms,function(n){n.preventDefault();var t=$(this);return window.Dropzone&&(i.getQueuedFiles().length===0?ALERTSYSTEM.Toastr.ShowWarning("You must select a XLSX file to upload!"):(MAINMODULE.Common.RemoveErrorFromButton(t),MAINMODULE.Common.DisableButton(t),li(t,function(n){console.log(n);ALERTSYSTEM.ShowSuccessMessage("Awesome!",function(){window.location=n.url})}))),!1})}function wt(){t.containerDetails.on("click",n.btnSaveTerms,function(n){var i,r;return n.preventDefault(),i=$(this),MAINMODULE.Common.DisableButton(i),r=t.form.valid(),r&&u?ai(i,function(n){n.message&&ALERTSYSTEM.Toastr.ShowWarning(n.message)}):MAINMODULE.Common.RemoveErrorFromButton(i),!1})}function bt(){t.container.on("click",n.btnEdit,function(n){n.preventDefault();var t=$(this).data("url");u&&ri(t)})}function kt(){t.container.on("click",n.btnDelete,function(n){n.preventDefault();var t=$(this);return u&&ui(t),!1})}function dt(){t.container.on("click",n.btnAddTerm,function(n){return n.preventDefault(),fi(),!1})}function gt(){t.containerDetails.on("click",n.btnDeleteTerm,function(n){n.preventDefault();var t=$(this);return ei(t),!1})}function ni(n,i){t.list.html(MAINMODULE.Default.Spinner);t.containerDetails.html("");t.containerDetails.hide();$.get(i,function(i){n?(t.list.html(i),t.containerList.show(),cacheObjects()):t.list.html(i)})}function y(i){t.termCounter.html("...");var r=t.urls.data("urlTerms"),u=t.id.val();u!=="000000-0000-0000-0000-000000000000"&&(r=r+u,t.divTerms.html(MAINMODULE.Default.SpinnerTop),$.get(r,function(r){t.divTerms.html(r);t.btnSaveTerms=$(n.btnSaveTerms);t.divNoItems=$(n.divNoItems);h();c();i&&i(r);MAINMODULE.Common.BindPopOvers()}))}function ti(n,i){t.myProjects.html(MAINMODULE.Default.SpinnerTop);$.get(i,function(i){n?(t.myProjects.html(i),t.containerList.show(),cacheObjects()):t.myProjects.html(i)})}function ii(i){t.containerDetails.html(MAINMODULE.Default.Spinner);t.containerList.hide();$.get(i,function(i){t.containerDetails.html(i);t.containerDetails.show();t.form=$(n.form);o()})}function ri(n){t.containerDetails.html(MAINMODULE.Default.Spinner);t.containerList&&t.containerList.hide();$.get(n,function(n){t.containerDetails.html(n);t.containerDetails.show();o()})}function ui(n,t){var r=n.data("url"),i=MAINMODULE.Common.GetDeleteMessages(n);ALERTSYSTEM.ShowConfirmMessage(i.confirmationTitle,i.msg,i.confirmationButtonText,i.cancelButtonText,function(){$.ajax({url:r,type:"DELETE"}).done(function(n){n.success?(t&&t(n),MAINMODULE.Common.HandleSuccessDefault(n)):ALERTSYSTEM.ShowWarningMessage(n.message)})})}function fi(){var i=$(n.template).first().clone();i.find(":input").val("");i.removeClass("template");i.prependTo(n.divTerms);i.find("input.form-control").first().focus();MAINMODULE.Common.RenameInputs(t.divTerms,n.termItem,v);h();MAINMODULE.Common.BindPopOvers();c()}function ei(i){var r=i.closest(n.termItem);r.remove();MAINMODULE.Common.RenameInputs(t.divTerms,n.termItem,v);h();c()}function oi(t,i){var r=$(n.entryAuthorTemplate).first().clone(),u=r.find("button");u.attr("data-userid",i.userId);u.attr("title",i.authorName);u.attr("data-value",i.value);r.removeClass("template");r.appendTo(t)}function si(i,r){var u=t.containerDetails.find(n.entryInput+"[data-termid="+i+"]"),f=u.closest(n.entry),e=f.find(n.entryAuthorButton+"[data-userId="+r+"]");e.parent().remove()}function s(n){var i=t.urls.data("urlEntriesGet"),r=n.val(),u={language:r};$.post(i,u).done(function(n){if(n.success===!0){hi();for(var t=0;t<n.value.length;t++)p(n.value[t])}else ALERTSYSTEM.ShowWarningMessage("An error occurred! Check the console!")})}function hi(){var i=t.containerDetails.find(n.entryInput);i.each(function(n,t){$(t).data("translated",!1)});$(n.entryAuthors).html("")}function p(i){var r=t.containerDetails.find(n.entryInput+"[data-termid="+i.termId+"]");r.val(i.value);r.data("originalval",i.value);r.data("translated",!0);oi(r.closest(n.entry).find(n.entryAuthors),i)}function ci(n,r){var u=t.form.attr("action"),f=t.form.serialize();$.post(u,f).done(function(t){if(t.success===!0){if(MAINMODULE.Common.PostSaveCallback(t,n),r&&r(),window.Dropzone){i.getQueuedFiles().length>0&&console.log(i.getQueuedFiles());i.on("sending",function(n,i,r){r.append("projectId",t.value)});i.processQueue();i.on("success",function(n){var t=JSON.parse(n.xhr.response);console.log(t)});i.on("queuecomplete",function(n){console.log(n)})}ALERTSYSTEM.ShowSuccessMessage("Awesome!",function(){window.location=t.url})}else ALERTSYSTEM.ShowWarningMessage("An error occurred! Check the console!")})}function li(t,r){if(window.Dropzone){var u=t.data("projectId"),f=$(n.ddlColumn);i.on("sending",function(n,t,i){i.append("projectId",u);var r=0;f.each(function(n,t){var f=$(t),e=f.data("column"),u=f.val();e!==undefined&&u!==undefined&&u.length>0&&(i.append("columns["+r+"].Column",e),i.append("columns["+r+"].Language",u),r++)})});i.processQueue();i.on("success",function(n,t){console.log(n);r&&r(t)});i.on("queuecomplete",function(n){console.log(n)})}}function ai(i,r){var u=t.urls.data("urlTermsSave"),o=t.id.val(),f,e;u=u+o;f=$(n.termItem);e=f.find(":input, :hidden").serializeObject();$.post(u,e).done(function(n){n.success===!0?(MAINMODULE.Common.PostSaveCallback(n,i),MAINMODULE.Common.HandleSuccessDefault(n,r,function(n){console.log(n);MAINMODULE.Common.RemoveErrorFromButton(i);y()})):ALERTSYSTEM.ShowWarningMessage("An error occurred! Check the console!")})}function vi(){if(window.Dropzone){var r=t.divUploadTerms.data("url");i&&(i.destroy(),i=null);i=new Dropzone(n.divUploadTerms,{url:r,paramName:"termsFile",addRemoveLinks:!0,autoProcessQueue:!1,maxFiles:1})}}function yi(){var n=t.changedCounter.data("count");return n++,t.changedCounter.data("count",n),t.changedCounter.html(n),n}function w(){var n=t.changedCounter.data("count");return n--,n<0&&(n=0),t.changedCounter.data("count",n),t.changedCounter.html(n),n}function b(){t.changedCounter.data("count",0);t.changedCounter.html(0)}function k(n,t){const i=n.indexOf(t);n.splice(i,1)}function pi(){MAINMODULE.Layout.SetStickyElement("#divTranslationSelector",50,"#divTranslationSelector")}function wi(){MAINMODULE.Layout.SetStickyElement("#divManualTerms",50,"#divManualTerms")}function h(){var i=$(n.termItem+":not(.template)").length;t.termCounter.html(i);i===0?t.divNoItems.show():t.divNoItems.hide()}function c(){t.form.removeData("validator").removeData("unobtrusiveValidation");$.validator.unobtrusive.parse(t.form)}var n={},t={},u=!1,l=!1,a=!1,f=!1,e=!1,r=[],v="Terms",i=null;return{Init:ut}}(),CONTENTACTIONS;$(function(){TRANSLATION.Init()});window.Dropzone!==undefined&&(Dropzone.autoDiscover=!1);CONTENTACTIONS=function(){"use strict";function e(){o();s();h()}function o(){n.container=".content";n.btnShare=".btn-share";n.sharePopup=".share-popup";n.btnInteractionComment=".btn-interaction-comment";n.commentBox=".interaction-commentbox";n.commentTextArea=".commenttextarea";n.btnInteractionShare=".btn-interaction-share";n.sharePopup=".share-popup"}function s(){t.container=$(n.container)}function h(){c();l();a();v();y();i()}function c(){t.container.on("click",".btn-interaction-like",function(){var n=$(this),t=n.closest(".box-content").find(".like-count"),i=n.data("id");n.hasClass("like-liked")?b(i).done(function(i){k(i,t,n)}):p(i).done(function(i){w(i,t,n)})})}function l(){$(".content").on("click",n.btnInteractionComment,function(){var t=$(this),i=t.closest(".box-content").find(".box-commentsection"),r=t.closest(".box-content").find(n.commentBox),u=t.closest(".box-content").find(n.commentTextArea);i.is(":visible")?(i.addClass("d-none"),r.addClass("d-none")):(i.removeClass("d-none"),r.removeClass("d-none"),u.val("").focus())})}function a(){$(".content").on("keyup","textarea.commentbox",function(n){var i=$(this);if((n.keyCode===10||n.keyCode===13)&&n.ctrlKey){var t=i.closest(".interaction-commentbox").find(".commenttextarea"),o=t.data("url"),s=i.closest(".box-content").find(".comment-count"),h=t.data("usercontentid"),e=t.val().replace(/\n/g,"<br>\n"),c=t.data("usercontenttype");e.length>0&&r(o,h,e,c).done(function(n){u(n,s,t)})}f(this)})}function v(){$(".content").on("click",".btn-interaction-comment-send",function(){var i=$(this),n=i.closest(".interaction-commentbox").find(".commenttextarea"),f=n.data("url"),e=n.closest(".box-content"),o=e.find(".comment-count"),s=n.data("usercontentid"),t=n.val().replace(/\n/g,"<br>\n"),h=n.data("usercontenttype");t.length>0&&r(f,s,t,h).done(function(t){u(t,o,n)})})}function y(){t.container.on("click",n.btnShare,function(t){var u;t.preventDefault();$(n.sharePopup).fadeOut();var i=$(this).prop("href"),f=$(this).data("title"),r=$(this).data("provider");return i=encodeURI(i),r==="facebook"?FB.ui({method:"share",href:i},function(){}):r==="reddit"?(i="https://www.reddit.com/submit?title="+f+"&url="+i,window.open(i)):r==="twitter"?(u=$(this).data("text"),i="https://www.twitter.com/intent/tweet?text="+u+" "+i,window.open(i)):console.log(r),!1})}function i(){$(n.btnInteractionShare).each(function(t,i){var r=$(i),u=r.data();if(u.target){$(r).off("click");$(r).on("click",function(){console.log("clickshare");var t=$(u.target),i=r.position();t.css("top",i.top-80);t.on("mouseleave",function(){setTimeout(function(){t.is(":visible")&&t.fadeOut()},500)});$(n.sharePopup).fadeOut();t.is(":visible")?t.fadeOut():t.fadeIn()})}})}function p(n){return $.post("/content/like",{targetId:n})}function w(n,t,i){n.success===!0&&($(t).text(n.value),i.addClass("text-blue"),i.addClass("like-liked"))}function b(n){return $.post("/content/unlike",{targetId:n})}function k(n,t,i){n.success===!0&&($(t).text(n.value),i.removeClass("text-blue"),i.removeClass("like-liked"))}function r(n,t,i,r){return(n===null||n===undefined||n.length===0)&&(n="/content/comment"),$.post(n,{UserContentId:t,Text:i,UserContentType:r})}function u(n,t,i){var u,f,r,e,o;n.success===!0&&(u=i.closest(".interaction-commentbox"),f=i.val().replace(/\n/g,"<br>\n"),i.val(""),$(t).text(n.value),CONTENTACTIONS.AutosizeTextArea(i[0]),r=$(".box-comment-template").first().clone(),e=u.find("img").attr("src"),r.find("img").attr("src",e),r.find(".comment-authorname").text(u.data("fullname")),r.find(".comment-content").html(f),o=i.closest(".box-comments").find(".box-commentsection"),o.append(r.removeClass("d-none")))}function f(n){setTimeout(function(){n.style.cssText="height:auto;";n.style.cssText="height:"+(n.scrollHeight+2)+"px"},0)}var n={},t={};return{Init:e,AutosizeTextArea:f,BindShareContent:i}}();$(function(){CONTENTACTIONS.Init()});